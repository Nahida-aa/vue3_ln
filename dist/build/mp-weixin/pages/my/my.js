"use strict";const e=require("../../common/vendor.js"),o=require("../../utils/system.js"),a=require("../../api/apis.js"),t=require("../../config/index.js"),s=require("../../store/user.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-icons/uni-icons.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-popup/uni-popup.js"))();const i={__name:"my",setup(i){const n=s.useUserStore(),r=e.computed((()=>n.score_count)),l=e.computed((()=>n.download_count)),u=e.ref({avatar:"",nickname:"",username:"",address:{}}),p=e.computed((()=>u.value.avatar?u.value.avatar:t.defaultAvatar));a.apiUserInfo().then((e=>{Object.assign(u.value,e.data),n.updateScoreCount(u.value.score_count),n.updateDownloadCount(u.value.download_count),l.value=n.download_count,r.value=n.score_count}));const d=(o,a)=>{e.index.navigateTo({url:"/pages/wallpaperList/wallpaperList?name="+o+"&type="+a})},c=o=>{e.index.navigateTo({url:"/pages/notice/detail?id="+o})},v=e.ref(null),m=()=>{v.value.open()},f=()=>{v.value.close(),e.index.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:o=>{const a=o.tempFilePaths[0];o.tempFiles[0].name,e.index.uploadFile({url:t.baseURL+"/api/wallpaper/user-avatar/upload_avatar/",filePath:a,name:"file",success:o=>{const a=JSON.parse(o.data);0==a.errCode?(u.avatar=a.url,e.index.showToast({title:"头像上传成功",icon:"success"})):e.index.showToast({title:a.errMsg,icon:"none"})},fail:o=>{e.index.showToast({title:"因网络上传失败",icon:"none"})}})}})},y=()=>{v.value.close()};return(a,t)=>({a:e.unref(o.getNavBarHeight)()+"px",b:p.value,c:e.o(m),d:e.t(u.value.IP),e:e.t(u.value.address.city||u.value.address.province||u.value.address.country||"未知"),f:e.f(1,((o,a,t)=>({a:"294de070-0-"+t,b:"294de070-1-"+t,c:e.o((e=>d("我的下载","download")),o),d:o}))),g:e.p({type:"download-filled",size:"20"}),h:e.t(l.value),i:e.p({type:"right",size:"15",color:"#999"}),j:e.p({type:"star-filled",size:"20"}),k:e.t(r.value),l:e.p({type:"right",size:"15",color:"#999"}),m:e.o((e=>d("我的评分","score"))),n:e.p({type:"chatboxes-filled",size:"20"}),o:e.p({type:"right",size:"15",color:"#999"}),p:e.f(1,((o,a,t)=>({a:"294de070-6-"+t,b:"294de070-7-"+t,c:e.o((e=>c(2)),o),d:o}))),q:e.p({type:"notification-filled",size:"20"}),r:e.p({type:"right",size:"15",color:"#999"}),s:e.p({type:"help-filled",size:"20"}),t:e.p({type:"right",size:"15",color:"#999"}),v:e.o((e=>c(3))),w:e.o(f),x:e.o(y),y:e.sr(v,"294de070-10",{k:"avatarPopup"}),z:e.p({type:"bottom"})})}},n=e._export_sfc(i,[["__scopeId","data-v-294de070"]]);wx.createPage(n);
